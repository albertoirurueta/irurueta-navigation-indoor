<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Beacon.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-navigation-indoor</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.navigation.indoor</a> &gt; <span class="el_source">Beacon.java</span></div><h1>Beacon.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2018 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.navigation.indoor;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * The &lt;code&gt;Beacon&lt;/code&gt; class represents a single hardware Beacon detected by
 * an Android device.
 *
 * &lt;pre&gt;A Beacon is identified by a unique multi-part identifier, with the first of the ordered
 * identifiers being more significant for the purposes of grouping beacons.
 *
 * A Beacon sends a Bluetooth Low Energy (BLE) advertisement that contains these
 * three identifiers, along with the calibrated tx power (in RSSI) of the Beacon's
 * Bluetooth transmitter.
 * &lt;/pre&gt;
 * &lt;p&gt;
 * Based on:
 * &lt;a href=&quot;https://github.com/AltBeacon/android-beacon-library/blob/master/src/main/java/org/altbeacon/beacon/Beacon.java&quot;&gt;
 *   https://github.com/AltBeacon/android-beacon-library/blob/master/src/main/java/org/altbeacon/beacon/Beacon.java
 * &lt;/a&gt;
 */
public class Beacon implements Serializable, RadioSource {

    /**
     * Default frequency used by a Beacon when none is specified (expressed in Hz).
     */
    public static final double DEFAULT_FREQUENCY = 2.4e9;

    /**
     * The list of the multipart identifiers of the beacon. Together, these identifiers signify
     * a unique beacon. The identifiers are ordered by significance for the purpose of grouping
     * beacons.
     */
    private ArrayList&lt;BeaconIdentifier&gt; identifiers;

    /**
     * The calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * This value is baked into a Beacon when it is manufactured, and it is
     * transmitted with each packet to aid in the distance estimate.
     */
    private double transmittedPower;

    /**
     * The Bluetooth mac address.
     */
    private String bluetoothAddress;

    /**
     * The two byte value indicating the type of beacon that this is, which is used for figuring
     * out the byte layout of the beacon advertisement.
     */
    private int beaconTypeCode;

    /**
     * A two byte code indicating the beacon manufacturer. A list of registered manufacturer codes
     * may be found here:
     * &lt;a href=&quot;https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers&quot;&gt;
     *   https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers
     * &lt;/a&gt;
     * &lt;p&gt;
     * If the beacon is a GATT-based beacon, this field will be set to -1.
     */
    private int manufacturer;

    /**
     * A 32 bit service uuid for the beacon.
     * This is valid only for GATT-based beacons. If the beacon is a manufacturer data-based
     * beacon, this field will be -1
     */
<span class="fc" id="L88">    private int serviceUuid = -1;</span>

    /**
     * The Bluetooth device name.  This is a field transmitted by the remote beacon device separate
     * from the advertisement data
     */
    private String bluetoothName;

    /**
     * Frequency used by this Beacon(expressed in Hz).
     */
<span class="fc" id="L99">    private double frequency = DEFAULT_FREQUENCY;</span>

    /**
     * Constructor.
     *
     * @param identifiers      list of the multipart identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @throws IllegalArgumentException if identifiers is null.
     */
<span class="fc" id="L108">    public Beacon(final List&lt;BeaconIdentifier&gt; identifiers, final double transmittedPower) {</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (identifiers == null) {</span>
<span class="fc" id="L110">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L113">        this.identifiers = new ArrayList&lt;&gt;(identifiers);</span>
<span class="fc" id="L114">        this.transmittedPower = transmittedPower;</span>
<span class="fc" id="L115">    }</span>

    /**
     * Constructor.
     *
     * @param identifiers      list of the multipart identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param bluetoothAddress the bluetooth mac address.
     * @param beaconTypeCode   the two byte value indicating the type of beacon.
     * @param manufacturer     a two byte code indicating the beacon manufacturer.
     * @param serviceUuid      a 32 bit service uuid for the beacon.
     * @param bluetoothName    the bluetooth device name.
     * @throws IllegalArgumentException if identifiers is null.
     */
    public Beacon(final List&lt;BeaconIdentifier&gt; identifiers, final double transmittedPower,
                  final String bluetoothAddress, final int beaconTypeCode, final int manufacturer,
                  final int serviceUuid, final String bluetoothName) {
<span class="fc" id="L132">        this(identifiers, transmittedPower);</span>

<span class="fc" id="L134">        this.bluetoothAddress = bluetoothAddress;</span>
<span class="fc" id="L135">        this.beaconTypeCode = beaconTypeCode;</span>
<span class="fc" id="L136">        this.manufacturer = manufacturer;</span>
<span class="fc" id="L137">        this.serviceUuid = serviceUuid;</span>
<span class="fc" id="L138">        this.bluetoothName = bluetoothName;</span>
<span class="fc" id="L139">    }</span>

    /**
     * Constructor.
     *
     * @param identifiers      list of the multipart identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param frequency        frequency used by this Beacon.
     * @throws IllegalArgumentException if identifiers is null or frequency is negative.
     */
    public Beacon(final List&lt;BeaconIdentifier&gt; identifiers, final double transmittedPower, final double frequency) {
<span class="fc" id="L150">        this(identifiers, transmittedPower);</span>

<span class="fc bfc" id="L152" title="All 2 branches covered.">        if (frequency &lt; 0.0) {</span>
<span class="fc" id="L153">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L156">        this.frequency = frequency;</span>
<span class="fc" id="L157">    }</span>

    /**
     * Constructor.
     *
     * @param identifiers      list of the multipart identifiers of the beacon.
     * @param transmittedPower calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * @param frequency        frequency used by this Beacon.
     * @param bluetoothAddress the bluetooth mac address.
     * @param beaconTypeCode   the two byte value indicating the type of beacon.
     * @param manufacturer     a two byte code indicating the beacon manufacturer.
     * @param serviceUuid      a 32 bit service uuid for the beacon.
     * @param bluetoothName    the bluetooth device name.
     * @throws IllegalArgumentException if identifiers is null.
     */
    public Beacon(final List&lt;BeaconIdentifier&gt; identifiers, final double transmittedPower, final double frequency,
                  final String bluetoothAddress, final int beaconTypeCode, final int manufacturer,
                  final int serviceUuid, final String bluetoothName) {
<span class="fc" id="L175">        this(identifiers, transmittedPower, bluetoothAddress, beaconTypeCode, manufacturer, serviceUuid, bluetoothName);</span>

<span class="fc bfc" id="L177" title="All 2 branches covered.">        if (frequency &lt; 0.0) {</span>
<span class="fc" id="L178">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L181">        this.frequency = frequency;</span>
<span class="fc" id="L182">    }</span>

    /**
     * Empty constructor.
     */
<span class="fc" id="L187">    protected Beacon() {</span>
<span class="fc" id="L188">    }</span>

    /**
     * Returns the specified identifier - 0 indexed.
     * Note: to read id1, call getIdentifier(0);
     *
     * @param i index identifier.
     * @return identifier or null if not available.
     */
    public BeaconIdentifier getIdentifier(final int i) {
<span class="pc bpc" id="L198" title="1 of 6 branches missed.">        if (i &lt; 0 || identifiers == null || identifiers.size() &lt;= i) {</span>
<span class="fc" id="L199">            return null;</span>
        }
<span class="fc" id="L201">        return identifiers.get(i);</span>
    }

    /**
     * Convenience method to get the first identifier.
     *
     * @return first identifier or null if not available.
     */
    public BeaconIdentifier getId1() {
<span class="fc bfc" id="L210" title="All 4 branches covered.">        if (identifiers == null || identifiers.isEmpty()) {</span>
<span class="fc" id="L211">            return null;</span>
        }
<span class="fc" id="L213">        return identifiers.get(0);</span>
    }

    /**
     * Convenience method to get the second identifier.
     *
     * @return second identifier or null if not available.
     */
    public BeaconIdentifier getId2() {
<span class="fc bfc" id="L222" title="All 4 branches covered.">        if (identifiers == null || identifiers.size() &lt; 2) {</span>
<span class="fc" id="L223">            return null;</span>
        }
<span class="fc" id="L225">        return identifiers.get(1);</span>
    }

    /**
     * Convenience method to get the third identifier.
     *
     * @return third identifier or null if not available.
     */
    public BeaconIdentifier getId3() {
<span class="fc bfc" id="L234" title="All 4 branches covered.">        if (identifiers == null || identifiers.size() &lt; 3) {</span>
<span class="fc" id="L235">            return null;</span>
        }
<span class="fc" id="L237">        return identifiers.get(2);</span>
    }

    /**
     * Gets the list of the multipart identifiers of the beacon. Together, these identifiers signify
     * a unique beacon. The identifiers are ordered by significance for the purpose of grouping
     * beacons.
     *
     * @return list of identifiers of the beacon or null if not available.
     */
    public List&lt;BeaconIdentifier&gt; getIdentifiers() {
<span class="fc bfc" id="L248" title="All 2 branches covered.">        return identifiers != null ? Collections.unmodifiableList(identifiers) : null;</span>
    }

    /**
     * Returns the calibrated measured Tx power of the Beacon in RSSI (expressed in dBm's).
     * This value is baked into a Beacon when it is manufactured, and it is
     * transmitted with each packet to aid in the distance estimate.
     *
     * @return the calibrated measured Tx power.
     */
    public double getTransmittedPower() {
<span class="fc" id="L259">        return transmittedPower;</span>
    }

    /**
     * Gets the bluetooth mac address.
     *
     * @return bluetooth mac address.
     */
    public String getBluetoothAddress() {
<span class="fc" id="L268">        return bluetoothAddress;</span>
    }

    /**
     * Gets the two byte value indicating the type of beacon that this is, which is used for figuring
     * out the byte layout of the beacon advertisement.
     *
     * @return two byte value indicating the type of beacon.
     */
    public int getBeaconTypeCode() {
<span class="fc" id="L278">        return beaconTypeCode;</span>
    }


    /**
     * Gets the Bluetooth device name. This is a field transmitted by the remote beacon device separate
     * from the advertisement data.
     *
     * @return bluetooth device name.
     */
    public String getBluetoothName() {
<span class="fc" id="L289">        return bluetoothName;</span>
    }

    /**
     * Gets a two byte code indicating the beacon manufacturer. A list of registered manufacturer codes
     * may be found here:
     * &lt;a href=&quot;https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers&quot;&gt;
     *   https://www.bluetooth.org/en-us/specification/assigned-numbers/company-identifiers
     * &lt;/a&gt;
     * &lt;p&gt;
     * If the beacon is a GATT-based beacon, this field will be set to -1.
     *
     * @return a two byte code indicating the beacon manufacturer.
     */
    public int getManufacturer() {
<span class="fc" id="L304">        return manufacturer;</span>
    }

    /**
     * Gets a 32 bit service uuid for the beacon.
     * This is valid only for GATT-based beacons. If the beacon is a manufacturer data-based
     * beacon, this field will be -1
     *
     * @return service uuid.
     */
    public int getServiceUuid() {
<span class="fc" id="L315">        return serviceUuid;</span>
    }

    /**
     * Gets frequency used by this radio source (expressed in Hz).
     *
     * @return frequency used by this radio source (expressed in Hz).
     */
    @Override
    public double getFrequency() {
<span class="fc" id="L325">        return frequency;</span>
    }

    /**
     * Checks whether two beacons are considered equal if they share the same identifiers.
     *
     * @param that beacon to be compared.
     * @return true if both beacons are considered equal, false otherwise.
     */
    @Override
    public boolean equals(final Object that) {
<span class="pc bpc" id="L336" title="1 of 2 branches missed.">        if (!(that instanceof Beacon thatBeacon)) {</span>
<span class="nc" id="L337">            return false;</span>
        }

<span class="pc bpc" id="L340" title="1 of 4 branches missed.">        return identifiers != null &amp;&amp; identifiers.equals(thatBeacon.identifiers);</span>
    }

    /**
     * Computes hash code for this instance.
     *
     * @return this instance hash code.
     */
    @Override
    public int hashCode() {
<span class="fc" id="L350">        return identifiers.hashCode();</span>
    }

    /**
     * Gets radio source type, which can be either a Wi-Fi Access point or a bluetooth Beacon.
     *
     * @return radio source type.
     */
    @Override
    public RadioSourceType getType() {
<span class="fc" id="L360">        return RadioSourceType.BEACON;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>